<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="utf-8">
    <title> HT 的实验室 </title>
    <script src="https://unpkg.com/vue/dist/vue.js"></script>

</head>
<body>
<!--<br>-->
<div class="  container" style="">


    <div class="page-header" style="text-align: center">
        <h1 class=""><strong>传感器实时平台</strong></h1>
        <!--<small style=""></small>-->
    </div>
    <div id="d1" class=" text-left">

        <p v-bind:style=""></p>
        <h3 class=" text-success"> 当前温度： {{tem}}</h3>
        <!--<p>         当前温度：    {{tem}}</p>-->
        <br>
        <h5>--------------------------------------------------------------------</h5>
        <h3 class=" text-success"> 当前湿度： {{wet}}</h3>

        <br>
        <br>
        <br>
        <h4 class=" text-info ">数据接收时间：  {{time}}</h4>
    </div>
    <br>
    <br>
    <br>

    <div class="">
        <address>
            <strong>Some China, Inc.</strong><br>
            Great Wall Park<br>
            WuHan City, STREE 民族大道<br>
            <abbr title="Phone">P:</abbr> 15662728521
        </address>
        <address>
            <strong>QIht</strong><br>
            <a href="mailto:#">qht131427@chrome.com</a>
        </address>
    </div>
</div>

<script>
    var key = {"key": "rinpo"}
    WebSocketTest()
    function WebSocketTest() {
        if ("WebSocket" in window) {
//            alert("您的浏览器支持 WebSocket!");// 打开一个
{#            var ws = new WebSocket("ws://server.ngrok.cc:59961");#}
            var ws = new WebSocket("ws://127.0.0.1:9999");

            ws.onopen = function () {// Web Socket 已连接上，使用 send() 方法发送数据
                ws.send(JSON.stringify(key))
                ws.send("发送数据");
                console.log("发送数据");
//                alert("数据发送中...");
            };
            ws.onmessage = function (evt) {
                var received_msg = evt.data;
                console.log(received_msg);
                received_msg = JSON.parse(received_msg);
                v1.tem = received_msg.tem
                v1.wet = received_msg.wet
                v1.time = received_msg.time

                /*
                 获取到新数据，填充到datatables里
                 */
//                table.ajax.reload();

//                alert("数据已接收...");
            };
            ws.onclose = function () {// 关闭 websocket
//                alert("连接已关闭...");
            };
        } else {// 浏览器不支持 WebSocket
            alert("您的浏览器不支持 WebSocket!");
        }
    }


    var v1 = new Vue({
        el: "#d1",
        data: {
            tem: "",
            wet: "",
            time: ""

        }
    })
</script>
</body>
</html>